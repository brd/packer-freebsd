{
  "variables": {
    "autoboot_delay": "-1",
    "arch": "amd64",
    "boot_wait": "45s",
    "ssh_wait_timeout": "30s",
    "headless": "true",
    "hostname": "freebsd-vagrant",
    "iso_daterev": "20170316-r315416",
    "buildtag": "STABLE",
    "iso_checksum": "3e5ec49c3872f6fac4cea8b27a83ba8694830bf9009a1365d6ff56d6876077b4487c77c81bbf9685a5677f6cb38ae6859908c4e5a0b45869c2cf64039ad00f31",
    "iso_version": "11.0",
    "iso_checksum_type": "sha512",
    "vagrant_username": "vagrant",
    "vagrant_password": "vagrant",
    "vmware_hardware_acceleration": "TRUE",
    "vmware_hardware_version": "12"
  },
  "builders": [
    {
      "type": "vmware-iso",
      "communicator": "ssh",
      "ssh_disable_agent": "true",
      "ssh_pty": "true",
      "boot_command": [
        "I<wait>",
        "<enter><wait>",
        "{{user `hostname`}}",
        "<enter><wait>",
        "s<wait>",
        "<up><spacebar>",
        "<enter><wait>",
        "<down><down><down><enter><wait>",
        "<enter><wait>",
        "<enter><wait>",
        "<spacebar><enter>",
        "<left>Y<wait10><wait10><wait10><wait10><wait10><wait10><wait10><wait10><wait10><wait10>",
        "vagrant<enter><wait>",
        "vagrant<enter><wait>",
        "<enter><wait>",
        "Y<wait>",
        "Y<wait10><wait10>",
        "Y<wait>",
        "Y<wait10><wait10>",
        "<enter><wait>",
        "a<enter><wait>",
        "<enter><wait>",
        "<enter><wait>",
        "<enter><wait>",
        "<enter><wait>",
        "<down><down><down><down>R<spacebar><wait>",
        "<down>I<spacebar><wait>",
        "<down>C<spacebar><wait>",
        "<down><spacebar><wait>",
        "<down><spacebar><wait>",
        "<enter><wait>",
        "Y<wait>",
        "{{user `vagrant_username`}}<enter><wait>",
        "Vagrant User<enter><wait>",
        "<enter><wait>",
        "<enter><wait>",
        "wheel",
        "<enter><wait>",
        "<enter><wait>",
        "tcsh",
        "<enter><wait>",
        "<enter><wait>",
        "0700",
        "<enter><wait>",
        "Y",
        "<enter><wait>",
        "N",
        "<enter><wait>",
        "N",
        "<enter><wait>",
        "{{user `vagrant_password`}}<enter><wait>",
        "{{user `vagrant_password`}}<enter><wait>",
        "N",
        "<enter><wait>",
        "Y",
        "<enter><wait>",
        "N",
        "<enter><wait>",
        "<enter><wait10><wait10>",
        "<left>",
        "Y<wait>",
        "sed -i -e 's/^#PermitRootLogin no/PermitRootLogin yes/' /etc/ssh/sshd_config<enter><wait>",
        "echo 'autoboot_delay=\"{{user `autoboot_delay`}}\"' >> /boot/loader.conf<enter><wait>",
        "echo 'if_vmx_load=\"YES\"' >> /boot/loader.conf<enter><wait>",
        "chsh -s sh root<enter><wait>",
        "exit<enter><wait>",
        "R<wait10><wait10><wait10><wait10><wait10>"
      ],
      "boot_wait": "{{user `boot_wait`}}",
      "disk_size": 20480,
      "guest_os_type": "freebsd-64",
      "headless": "{{user `headless`}}",
      "iso_checksum": "{{user `iso_checksum`}}",
      "iso_checksum_type": "{{user `iso_checksum_type`}}",
      "iso_url": "http://ftp.freebsd.org/pub/FreeBSD/snapshots/ISO-IMAGES/{{user `iso_version`}}/FreeBSD-{{user `iso_version`}}-{{user `buildtag`}}-{{user `arch`}}-{{user `iso_daterev`}}-disc1.iso",
      "shutdown_command": "poweroff; poweroff",
      "ssh_password": "vagrant",
      "ssh_username": "root",
      "ssh_wait_timeout": "{{user `ssh_wait_timeout`}}",
      "vm_name": "FreeBSD-{{user `iso_version`}}-{{user `buildtag`}}-{{user `arch`}}-{{user `iso_daterev`}}",
      "vmx_data": {
        "ethernet0.connectionType": "nat",
        "ethernet0.linkStatePropagation.enable": "FALSE",
        "ethernet0.present": "TRUE",
        "ethernet0.virtualDev": "vmxnet3",
        "ethernet0.wakeOnPcktRcv": "FALSE",
        "firmware": "efi",
        "serial0.present": "TRUE",
        "serial0.fileType": "pipe",
        "serial0.fileName": "/tmp/FreeBSD-{{user `iso_version`}}-{{user `buildtag`}}-{{user `arch`}}-{{user `iso_daterev`}}.serial0",
        "tools.syncTime": "FALSE",
        "mce.enable": "{{user `vmware_hardware_acceleration`}}",
        "vhu.enable": "{{user `vmware_hardware_acceleration`}}",
        "vhv.enable": "{{user `vmware_hardware_acceleration`}}",
        "vpmc.enable": "{{user `vmware_hardware_acceleration`}}",
        "virtualHW.version": "{{user `vmware_hardware_version`}}"
      }
    },
    {
      "type": "virtualbox-iso",
      "boot_command": [
        "I<wait>",
        "<enter><wait>",
        "{{user `hostname`}}",
        "<enter><wait>",
        "s<wait>",
        "<up><spacebar>",
        "<enter><wait>",
        "<down><down><down><enter><wait>",
        "<enter><wait>",
        "<enter><wait>",
        "<spacebar><enter>",
        "<left>Y<wait10><wait10><wait10><wait10><wait10><wait10><wait10><wait10><wait10><wait10>",
        "vagrant<enter><wait>",
        "vagrant<enter><wait>",
        "<enter><wait>",
        "Y<wait>",
        "Y<wait10><wait10>",
        "Y<wait>",
        "Y<wait10><wait10>",
        "<enter><wait>",
        "a<enter><wait>",
        "<enter><wait>",
        "<enter><wait>",
        "<enter><wait>",
        "n<spacebar><wait>",
        "p<spacebar><wait>",
        "<enter><wait>",
        "<down><down><down><down>R<spacebar><wait>",
        "<down>I<spacebar><wait>",
        "<down>C<spacebar><wait>",
        "<down><spacebar><wait>",
        "<down><spacebar><wait>",
        "<enter><wait>",
        "Y<wait>",
        "{{user `vagrant_username`}}<enter><wait>",
        "Vagrant User<enter><wait>",
        "<enter><wait>",
        "<enter><wait>",
        "wheel",
        "<enter><wait>",
        "<enter><wait>",
        "tcsh",
        "<enter><wait>",
        "<enter><wait>",
        "0700",
        "<enter><wait>",
        "Y",
        "<enter><wait>",
        "N",
        "<enter><wait>",
        "N",
        "<enter><wait>",
        "{{user `vagrant_password`}}<enter><wait>",
        "{{user `vagrant_password`}}<enter><wait>",
        "N",
        "<enter><wait>",
        "Y",
        "<enter><wait>",
        "N",
        "<enter><wait>",
        "<enter><wait10><wait10>",
        "<left>",
        "Y<wait>",
        "sed -i -e 's/#PermitRootLogin no/PermitRootLogin yes/' /etc/ssh/sshd_config<enter><wait>",
        "echo 'autoboot_delay=\"-1\"' >> /boot/loader.conf<enter><wait>",
        "echo 'vboxdrv_load=\"YES\"' >> /boot/loader.conf<enter><wait>",
        "echo 'vboxnet_enable=\"YES\"' >> /boot/loader.conf<enter><wait>",
        "sysrc vboxguest_enable YES<enter><wait>",
        "sysrc vboxservice_enable YES<enter><wait>",
        "chsh -s sh root<enter><wait>",
        "exit<enter><wait>",
        "R<wait10><wait10><wait10><wait10><wait10>"
      ],
      "boot_wait": "{{user `boot_wait`}}",
      "disk_size": 20480,
      "format": "ova",
      "guest_os_type": "freebsd-64",
      "headless": "{{user `headless`}}",
      "iso_checksum": "{{user `iso_checksum`}}",
      "iso_checksum_type": "{{user `iso_checksum_type`}}",
      "iso_url": "http://ftp.freebsd.org/pub/FreeBSD/snapshots/ISO-IMAGES/{{user `iso_version`}}/FreeBSD-{{user `iso_version`}}-{{user `buildtag`}}-{{user `arch`}}-{{user `iso_daterev`}}-disc1.iso",
      "shutdown_command": "poweroff; poweroff",
      "ssh_password": "vagrant",
      "ssh_username": "root",
      "ssh_wait_timeout": "{{user `ssh_wait_timeout`}}"
    }
  ],
  "provisioners": [
    {
      "scripts": [
        "../scripts/zfs-setup.sh",
        "../scripts/postinstall.sh"
      ],
      "type": "shell"
    }
  ],
  "post-processors": [
    {
      "output": "FreeBSD-{{user `iso_version`}}-{{user `buildtag`}}-zfs-{{user `iso_daterev`}}-{{.Provider}}.box",
      "type": "vagrant",
      "override": {
        "vmware": {
          "vagrantfile_template": "./Vagrantfile.vmware"
        },
        "virtualbox": {
          "vagrantfile_template": "./Vagrantfile.virtualbox"
        }
      }
    }
  ]
}
